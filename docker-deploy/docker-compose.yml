version: '3.2'

services:
  vaccom-mariadb:
    container_name: vaccom-mariadb
    image: vaccom/mariadb
    hostname: vaccom-mariadb
    restart: always
    build:
      context: ./mariadb
      dockerfile: Dockerfile
    environment:
      - MYSQL_ROOT_PASSWORD=Vaccom@2021
      - MYSQL_DATABASE=db_vaccom
      - MYSQL_USER=user_vaccom
      - MYSQL_USER_PASSWORD=Vaccom2021@
      - BACKEND_IP=20.0.0.3
    volumes:
      - "./mariadb/config:/etc/my.cnf.d"
      - "./mariadb/logs:/var/log/mariadb"
      - "./mariadb/databases:/var/lib/mysql"
    networks:
        vaccom:
          ipv4_address: 20.0.0.2
            
  vaccom-backend:
    container_name: vaccom-backend
    image: relateiq/oracle-java8
    hostname: vaccom-backend
    restart: always
    tty: true
    networks:
        vaccom:
          ipv4_address: 20.0.0.3
  
  vaccom-frontend:
    container_name: vaccom-frontend
    image: vaccom/frontend
    hostname: vaccom-frontend
    restart: always
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      - CERTBOT_EMAIL=hieunv@iwayvietnam.com
      - DOMAIN_LIST=thachban.vaccom.vn
      - DOMAIN=thachban.vaccom.vn
    volumes:
      - "./frontend/config/letsencrypt:/etc/letsencrypt"
      - "./frontend/config/nginx:/etc/nginx/conf.d"
      - "./frontend/logs/letsencrypt:/var/log/letsencrypt"
      - "./frontend/logs/nginx:/var/log/nginx"
    ports: 
      - '443:443'
      - '80:80'
    networks:
        vaccom:
          ipv4_address: 20.0.0.4

  vaccom-proxy:
    container_name: vaccom-proxy
    image: vaccom/proxy
    hostname: vaccom-proxy
    restart: always
    build:
      context: ./proxy
      dockerfile: Dockerfile
    environment:
      - DOMAIN=thachban.vaccom.vn
    volumes:
      - "./proxy/config/nginx:/etc/nginx/conf.d"
      - "./proxy/logs/nginx:/var/log/nginx"
    ports: 
      - '8080:8080'
    networks:
        vaccom:
          ipv4_address: 20.0.0.5

networks:
  vaccom:
    driver: bridge
    ipam:
     config:
       - subnet: 20.0.0.0/24